<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayU Form Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .form-container { max-width: 600px; margin: 0 auto; }
        .test-button { 
            background: #007bff; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 10px 0; 
        }
        .form-data { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 10px 0; 
            font-family: monospace; 
            white-space: pre-wrap; 
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>PayU Form Submission Test</h1>
        
        <button class="test-button" onclick="testPayUForm()">Test PayU Form Submission</button>
        
        <div id="result"></div>
    </div>

    <script>
        async function testPayUForm() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Testing PayU form submission...</p>';
            
            try {
                // Simulate the payment request
                const paymentRequest = {
                    quoteIds: ['test-quote-1'],
                    gateway: 'payu',
                    success_url: 'https://iwishbag.com/success',
                    cancel_url: 'https://iwishbag.com/cancel',
                    amount: 1.00,
                    currency: 'USD',
                    customerInfo: {
                        name: 'Test Customer',
                        email: 'test@example.com',
                        phone: '9999999999'
                    }
                };

                console.log('Sending payment request...');
                
                const response = await fetch('https://grgvlrvywsfmnmkxrecd.supabase.co/functions/v1/create-payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdyZ3ZscnZ5d3NmbW5ta3hyZWNkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA0MTEzMTIsImV4cCI6MjA2NTk4NzMxMn0.IAE4zqmnd3MF4JaMJ4sl8QLHbrcSgCSd5hfN4DVDGHw'
                    },
                    body: JSON.stringify(paymentRequest)
                });

                const result = await response.json();
                
                if (result.success && result.formData) {
                    console.log('Payment response received:', result);
                    
                    // Create and submit the form
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = result.url;
                    form.style.display = 'none';
                    form.target = '_self';

                    // Add all form fields
                    Object.keys(result.formData).forEach(key => {
                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = key;
                        input.value = result.formData[key];
                        form.appendChild(input);
                    });

                    // Show the form data before submitting
                    let formDataDisplay = 'Form Data to be submitted:\n';
                    Object.keys(result.formData).forEach(key => {
                        formDataDisplay += `${key}: ${result.formData[key]}\n`;
                    });
                    
                    resultDiv.innerHTML = `
                        <h3>✅ PayU Form Test Successful!</h3>
                        <p><strong>Form Action:</strong> ${result.url}</p>
                        <p><strong>Form Method:</strong> POST</p>
                        <div class="form-data">${formDataDisplay}</div>
                        <p>Form will be submitted in 3 seconds...</p>
                    `;
                    
                    // Add form to page
                    document.body.appendChild(form);
                    
                    // Submit after a short delay
                    setTimeout(() => {
                        console.log('Submitting form to PayU...');
                        form.submit();
                    }, 3000);
                    
                } else {
                    resultDiv.innerHTML = `
                        <h3>❌ PayU Form Test Failed</h3>
                        <p>Error: ${result.error || 'Unknown error'}</p>
                        <div class="form-data">${JSON.stringify(result, null, 2)}</div>
                    `;
                }
                
            } catch (error) {
                console.error('Test failed:', error);
                resultDiv.innerHTML = `
                    <h3>❌ PayU Form Test Failed</h3>
                    <p>Error: ${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html> 