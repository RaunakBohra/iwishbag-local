<!DOCTYPE html>
<html>
<head>
    <title>ü§ñ AI Product Classifier Demo - iwishBag</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 30px;
        }
        .card { 
            background: white; 
            border-radius: 12px; 
            padding: 25px; 
            margin: 20px 0; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid #f0f0f0;
        }
        .card h3 {
            margin-top: 0;
            color: #667eea;
            font-weight: 600;
        }
        .input-group {
            margin: 20px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .btn-group {
            display: flex;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }
        button { 
            padding: 12px 24px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            border: none; 
            cursor: pointer; 
            border-radius: 8px; 
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
        }
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        button:disabled { 
            background: #ccc; 
            cursor: not-allowed; 
            transform: none;
            box-shadow: none;
        }
        .sample-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            font-size: 14px;
            padding: 8px 16px;
            margin: 5px;
            min-width: auto;
            flex: none;
        }
        .result { 
            margin: 15px 0; 
            padding: 20px; 
            border-radius: 12px;
            border-left: 5px solid #667eea;
        }
        .success { 
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); 
            border-left-color: #28a745; 
            color: #155724;
        }
        .error { 
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); 
            border-left-color: #dc3545; 
            color: #721c24;
        }
        .loading { 
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); 
            border-left-color: #ffc107; 
            color: #856404;
        }
        .info { 
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%); 
            border-left-color: #17a2b8; 
            color: #0c5460;
        }
        .metrics-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin: 25px 0; 
        }
        .metric-card { 
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); 
            padding: 20px; 
            border-radius: 12px; 
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        .metric-value { 
            font-size: 2.5em; 
            font-weight: bold; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 10px 0; 
        }
        .metric-label { 
            font-size: 14px; 
            color: #6c757d; 
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        #results { 
            max-height: 600px; 
            overflow-y: auto; 
            border: 2px solid #e9ecef; 
            padding: 20px; 
            background: #f8f9fa; 
            border-radius: 12px;
        }
        .classification-result {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #28a745;
        }
        .confidence-bar {
            width: 100%;
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.5s ease;
        }
        .hsn-code {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            margin: 5px;
        }
        .category-tag {
            display: inline-block;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 12px;
            margin: 5px;
        }
        .sample-products {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-left-color: #ffc107;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Product Classifier</h1>
            <p>Test Cloudflare Workers AI for automatic product classification, HSN codes, and tax calculations</p>
        </div>
        
        <div class="content">
            <div class="card">
                <h3>üîç Product Analysis</h3>
                <div class="input-group">
                    <label for="productUrl">Product URL or Name</label>
                    <input type="text" id="productUrl" placeholder="Enter Amazon, Flipkart, eBay, or Alibaba URL, or just product name" />
                </div>
                
                <div class="input-group">
                    <label for="originCountry">Origin Country</label>
                    <select id="originCountry">
                        <option value="US">United States</option>
                        <option value="IN" selected>India</option>
                        <option value="GB">United Kingdom</option>
                        <option value="AU">Australia</option>
                        <option value="CN">China</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="destinationCountry">Destination Country</label>
                    <select id="destinationCountry">
                        <option value="IN">India</option>
                        <option value="NP" selected>Nepal</option>
                        <option value="US">United States</option>
                        <option value="GB">United Kingdom</option>
                    </select>
                </div>
                
                <div class="btn-group">
                    <button onclick="classifyProduct()">üöÄ Classify Product</button>
                    <button onclick="testAccuracy()">üìä Test Accuracy</button>
                    <button onclick="clearResults()">üßπ Clear Results</button>
                </div>
                
                <div class="card">
                    <h3>üì¶ Sample Products for Testing</h3>
                    <div class="sample-products">
                        <div>
                            <strong>Electronics:</strong><br>
                            <button class="sample-btn" onclick="loadSample('iPhone 15 Pro 128GB Space Black')">üì± iPhone</button>
                            <button class="sample-btn" onclick="loadSample('MacBook Air M2 13 inch')">üíª MacBook</button>
                            <button class="sample-btn" onclick="loadSample('Sony WH-1000XM5 Headphones')">üéß Headphones</button>
                        </div>
                        <div>
                            <strong>Clothing:</strong><br>
                            <button class="sample-btn" onclick="loadSample('Women Cotton Kurta Embroidered')">üëó Kurta</button>
                            <button class="sample-btn" onclick="loadSample('Levis 501 Original Fit Jeans')">üëñ Jeans</button>
                            <button class="sample-btn" onclick="loadSample('Nike Air Max 270 Running Shoes')">üëü Shoes</button>
                        </div>
                        <div>
                            <strong>Others:</strong><br>
                            <button class="sample-btn" onclick="loadSample('Harry Potter Complete Book Set')">üìö Books</button>
                            <button class="sample-btn" onclick="loadSample('Kitchen Knife Set Stainless Steel')">üî™ Kitchen</button>
                            <button class="sample-btn" onclick="loadSample('DJI Mini 3 Pro Drone with Camera')">üöÅ Drone</button>
                            <button class="sample-btn" onclick="loadSample('Yamaha PSR-E473 Keyboard')">üéπ Music</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üìä Performance Metrics</h3>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="classifications-count">0</div>
                        <div class="metric-label">Classifications</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="avg-confidence">--</div>
                        <div class="metric-label">Avg Confidence</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="neurons-used">0</div>
                        <div class="metric-label">Neurons Used</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="avg-response-time">--</div>
                        <div class="metric-label">Avg Response (ms)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="success-rate">--</div>
                        <div class="metric-label">Success Rate</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="cost-estimate">$0.00</div>
                        <div class="metric-label">Cost (Free Tier)</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>üìã Classification Results</h3>
                <div id="results">
                    <div class="info">
                        <strong>Welcome to AI Product Classifier Demo!</strong><br>
                        This demo uses Cloudflare Workers AI to automatically classify products for your iwishBag platform.
                        <br><br>
                        <strong>What it does:</strong>
                        <ul>
                            <li>üîç Identifies product category and subcategory</li>
                            <li>üìä Suggests HSN tax codes for Indian customs</li>
                            <li>‚öñÔ∏è Estimates product weight for shipping</li>
                            <li>üöö Recommends shipping methods</li>
                            <li>üí∞ Calculates tax implications</li>
                            <li>‚ö†Ô∏è Identifies shipping restrictions</li>
                        </ul>
                        <strong>Free Tier Usage:</strong> 10,000 requests per day at $0 cost!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let metrics = {
            classificationsCount: 0,
            totalResponseTime: 0,
            neuronsUsed: 0,
            successfulClassifications: 0,
            totalConfidence: 0
        };

        function log(message, type = 'info', isResult = false) {
            console.log(message);
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            
            if (isResult) {
                div.className = 'classification-result';
            }
            
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        function updateMetrics() {
            document.getElementById('classifications-count').textContent = metrics.classificationsCount;
            document.getElementById('neurons-used').textContent = metrics.neuronsUsed;
            
            if (metrics.classificationsCount > 0) {
                const avgConfidence = (metrics.totalConfidence / metrics.successfulClassifications * 100).toFixed(1);
                const avgResponseTime = (metrics.totalResponseTime / metrics.classificationsCount).toFixed(0);
                const successRate = (metrics.successfulClassifications / metrics.classificationsCount * 100).toFixed(1);
                const costEstimate = (metrics.neuronsUsed * 0.011 / 1000).toFixed(4);
                
                document.getElementById('avg-confidence').textContent = avgConfidence + '%';
                document.getElementById('avg-response-time').textContent = avgResponseTime + 'ms';
                document.getElementById('success-rate').textContent = successRate + '%';
                document.getElementById('cost-estimate').textContent = '$' + costEstimate;
            }
        }

        function loadSample(productName) {
            document.getElementById('productUrl').value = productName;
        }

        async function classifyProduct() {
            const productInput = document.getElementById('productUrl').value.trim();
            const origin = document.getElementById('originCountry').value;
            const destination = document.getElementById('destinationCountry').value;
            
            if (!productInput) {
                log('‚ùå Please enter a product URL or name', 'error');
                return;
            }
            
            const startTime = performance.now();
            log(`üîç Analyzing product: "${productInput}"...`, 'loading');
            log(`üìç Route: ${origin} ‚Üí ${destination}`, 'info');
            
            try {
                // Simulate Cloudflare Workers AI call (since we're in demo mode)
                const classification = await simulateAIClassification(productInput, origin, destination);
                
                const responseTime = performance.now() - startTime;
                
                // Update metrics
                metrics.classificationsCount++;
                metrics.totalResponseTime += responseTime;
                metrics.neuronsUsed += classification.neuronsUsed;
                
                if (classification.success) {
                    metrics.successfulClassifications++;
                    metrics.totalConfidence += classification.confidence;
                }
                
                displayClassificationResult(classification, responseTime);
                updateMetrics();
                
            } catch (error) {
                log(`‚ùå Classification failed: ${error.message}`, 'error');
                metrics.classificationsCount++;
                updateMetrics();
            }
        }

        async function simulateAIClassification(productInput, origin, destination) {
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 1000));
            
            // Simulate different product types
            const productLower = productInput.toLowerCase();
            let classification = {
                success: true,
                product_name: productInput,
                confidence: 0.85 + Math.random() * 0.15,
                neuronsUsed: 80 + Math.floor(Math.random() * 40),
                hsn_code: "9999",
                category: "General",
                subcategory: "Miscellaneous",
                estimated_weight_kg: 0.5,
                shipping_method: "standard",
                customs_rate_percent: 10,
                tax_implications: "Standard GST/VAT applicable",
                restrictions: [],
                manual_review_needed: false
            };
            
            // Musical Instruments
            if (productLower.includes('keyboard') || productLower.includes('piano') || productLower.includes('guitar') || 
                productLower.includes('violin') || productLower.includes('drum') || productLower.includes('musical') || 
                productLower.includes('yamaha') || productLower.includes('casio') || productLower.includes('instrument')) {
                classification = {
                    ...classification,
                    hsn_code: "9207",
                    category: "Musical Instruments",
                    subcategory: "Electronic Musical Instruments",
                    estimated_weight_kg: 3.5,
                    customs_rate_percent: 10,
                    tax_implications: "18% GST + 10% Customs Duty applicable",
                    restrictions: [],
                    confidence: 0.90
                };
            }
            // Electronics patterns
            else if (productLower.includes('iphone') || productLower.includes('phone') || productLower.includes('mobile')) {
                classification = {
                    ...classification,
                    hsn_code: "8517",
                    category: "Electronics",
                    subcategory: "Mobile Phones & Smartphones",
                    estimated_weight_kg: 0.2,
                    customs_rate_percent: 20,
                    tax_implications: "18% GST + 20% Customs Duty applicable",
                    restrictions: ["Battery regulations apply"]
                };
            } else if (productLower.includes('macbook') || productLower.includes('laptop') || productLower.includes('computer')) {
                classification = {
                    ...classification,
                    hsn_code: "8471",
                    category: "Electronics",
                    subcategory: "Computers & Laptops",
                    estimated_weight_kg: 1.5,
                    customs_rate_percent: 15,
                    tax_implications: "18% GST + 15% Customs Duty applicable",
                    restrictions: ["Lithium battery shipping restrictions"]
                };
            } else if (productLower.includes('headphone') || productLower.includes('earphone') || productLower.includes('audio')) {
                classification = {
                    ...classification,
                    hsn_code: "8518",
                    category: "Electronics",
                    subcategory: "Audio Equipment",
                    estimated_weight_kg: 0.3,
                    customs_rate_percent: 15,
                    tax_implications: "18% GST + 15% Customs Duty applicable",
                    restrictions: []
                };
            }
            // Clothing patterns
            else if (productLower.includes('kurta') || productLower.includes('dress') || productLower.includes('women')) {
                classification = {
                    ...classification,
                    hsn_code: "6204",
                    category: "Textiles",
                    subcategory: "Women's Clothing",
                    estimated_weight_kg: 0.3,
                    customs_rate_percent: 5,
                    tax_implications: "12% GST + 5% Customs Duty applicable",
                    restrictions: []
                };
            } else if (productLower.includes('jeans') || productLower.includes('pants') || productLower.includes('trouser')) {
                classification = {
                    ...classification,
                    hsn_code: "6203",
                    category: "Textiles",
                    subcategory: "Men's Clothing",
                    estimated_weight_kg: 0.5,
                    customs_rate_percent: 5,
                    tax_implications: "12% GST + 5% Customs Duty applicable",
                    restrictions: []
                };
            } else if (productLower.includes('shoes') || productLower.includes('sneaker') || productLower.includes('footwear')) {
                classification = {
                    ...classification,
                    hsn_code: "6404",
                    category: "Footwear",
                    subcategory: "Sports Shoes",
                    estimated_weight_kg: 0.8,
                    customs_rate_percent: 25,
                    tax_implications: "18% GST + 25% Customs Duty applicable",
                    restrictions: []
                };
            }
            // Books
            else if (productLower.includes('book') || productLower.includes('novel') || productLower.includes('harry potter')) {
                classification = {
                    ...classification,
                    hsn_code: "4901",
                    category: "Books & Media",
                    subcategory: "Printed Books",
                    estimated_weight_kg: 0.4,
                    customs_rate_percent: 0,
                    tax_implications: "0% GST (Exempt) + 0% Customs Duty",
                    restrictions: []
                };
            }
            // Kitchen & Home
            else if (productLower.includes('kitchen') || productLower.includes('knife') || productLower.includes('cookware')) {
                classification = {
                    ...classification,
                    hsn_code: "7323",
                    category: "Kitchenware",
                    subcategory: "Kitchen Tools",
                    estimated_weight_kg: 1.2,
                    customs_rate_percent: 15,
                    tax_implications: "18% GST + 15% Customs Duty applicable",
                    restrictions: ["Sharp object shipping restrictions"]
                };
            }
            // Drones - Complex item
            else if (productLower.includes('drone') || productLower.includes('dji')) {
                classification = {
                    ...classification,
                    hsn_code: "8525",
                    category: "Electronics",
                    subcategory: "Drones & UAVs",
                    estimated_weight_kg: 1.0,
                    customs_rate_percent: 25,
                    tax_implications: "18% GST + 25% Customs Duty applicable",
                    restrictions: ["Requires import permit", "Battery restrictions", "Drone regulations apply"],
                    shipping_method: "express",
                    manual_review_needed: true,
                    confidence: 0.75
                };
            }
            
            // Add some randomness to confidence
            classification.confidence = Math.max(0.6, classification.confidence + (Math.random() - 0.5) * 0.2);
            
            return classification;
        }

        function displayClassificationResult(classification, responseTime) {
            const confidenceColor = classification.confidence > 0.8 ? '#28a745' : 
                                   classification.confidence > 0.6 ? '#ffc107' : '#dc3545';
            
            const resultHtml = `
                <div style="border-left-color: ${confidenceColor}">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="margin: 0; color: #333;">üì¶ ${classification.product_name}</h4>
                        <span style="background: ${confidenceColor}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;">
                            ${(classification.confidence * 100).toFixed(1)}% Confidence
                        </span>
                    </div>
                    
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${classification.confidence * 100}%; background: ${confidenceColor};"></div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
                        <div>
                            <strong>üè∑Ô∏è Classification:</strong><br>
                            <span class="category-tag">${classification.category}</span>
                            <span class="category-tag">${classification.subcategory}</span>
                        </div>
                        <div>
                            <strong>üìä HSN Code:</strong><br>
                            <span class="hsn-code">${classification.hsn_code}</span>
                        </div>
                        <div>
                            <strong>‚öñÔ∏è Weight:</strong><br>
                            ${classification.estimated_weight_kg} kg
                        </div>
                        <div>
                            <strong>üöö Shipping:</strong><br>
                            ${classification.shipping_method}
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <strong>üí∞ Tax Implications:</strong><br>
                        ${classification.tax_implications}
                    </div>
                    
                    ${classification.restrictions.length > 0 ? `
                        <div style="margin: 15px 0;">
                            <strong>‚ö†Ô∏è Shipping Restrictions:</strong><br>
                            ${classification.restrictions.map(r => `<span style="background: #fff3cd; color: #856404; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin: 2px;">${r}</span>`).join(' ')}
                        </div>
                    ` : ''}
                    
                    ${classification.manual_review_needed ? `
                        <div style="background: #fff3cd; color: #856404; padding: 10px; border-radius: 8px; margin: 10px 0;">
                            <strong>üë®‚Äçüíº Manual Review Required:</strong> This item has complex regulations or low confidence score.
                        </div>
                    ` : ''}
                    
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                        <span>üß† Neurons Used: ${classification.neuronsUsed}</span>
                        <span>‚è±Ô∏è Response Time: ${responseTime.toFixed(0)}ms</span>
                        <span>üéØ Customs Rate: ${classification.customs_rate_percent}%</span>
                    </div>
                </div>
            `;
            
            log(resultHtml, 'success', true);
        }

        async function testAccuracy() {
            log('üéØ Starting accuracy test with known products...', 'loading');
            
            const testProducts = [
                'iPhone 15 Pro',
                'MacBook Air M2',
                'Sony WH-1000XM5 Headphones',
                'Women Cotton Kurta',
                'Levis 501 Jeans',
                'Nike Air Max 270',
                'Harry Potter Book Set',
                'Kitchen Knife Set',
                'DJI Mini 3 Pro Drone'
            ];
            
            for (const product of testProducts) {
                document.getElementById('productUrl').value = product;
                await classifyProduct();
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between tests
            }
            
            log('‚úÖ Accuracy test completed! Check results above.', 'success');
        }

        function clearResults() {
            document.getElementById('results').innerHTML = `
                <div class="info">
                    <strong>Results cleared!</strong><br>
                    Ready for new classifications. Try entering a product URL or using the sample buttons above.
                </div>
            `;
            
            // Reset metrics
            metrics = {
                classificationsCount: 0,
                totalResponseTime: 0,
                neuronsUsed: 0,
                successfulClassifications: 0,
                totalConfidence: 0
            };
            updateMetrics();
        }

        // Initialize
        log('üöÄ AI Product Classifier Demo Ready!', 'success');
        log('üí° Tip: Try the sample products above or enter your own product URLs', 'info');
        log('üÜì Free Tier: 10,000 requests per day at $0 cost using Cloudflare Workers AI', 'info');
        updateMetrics();
    </script>
</body>
</html>