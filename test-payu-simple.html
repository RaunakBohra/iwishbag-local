<!doctype html>
<html>
  <head>
    <title>Simple PayU Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 600px;
        margin: 0 auto;
      }
      .form-container {
        background: #f0f8ff;
        padding: 20px;
        border-radius: 10px;
        border: 2px solid #4caf50;
      }
      button {
        padding: 10px 20px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      .info {
        background: #e3f2fd;
        padding: 15px;
        border-radius: 5px;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <h1>PayU Simple Form Test</h1>

    <div class="info">
      <p>
        <strong>Purpose:</strong> Test if PayU can receive form data when submitted from a simple,
        static HTML page.
      </p>
      <p>This form uses the exact same data structure and PayU test keys as your app.</p>
    </div>

    <div class="form-container">
      <h3>PayU Payment Form</h3>
      <form id="payuTestForm" method="POST" action="https://test.payu.in/_payment">
        <!-- Keys will be populated by JavaScript -->
        <input type="hidden" name="key" value="" />
        <input type="hidden" name="txnid" value="" />
        <input type="hidden" name="amount" value="100.00" />
        <input type="hidden" name="productinfo" value="" />
        <input type="hidden" name="firstname" value="Test User" />
        <input type="hidden" name="email" value="test@example.com" />
        <input type="hidden" name="phone" value="9999999999" />
        <input type="hidden" name="surl" value="https://example.com/success" />
        <input type="hidden" name="furl" value="https://example.com/failure" />
        <input type="hidden" name="hash" value="" />
        <input type="hidden" name="udf1" value="" />
        <input type="hidden" name="udf2" value="" />
        <input type="hidden" name="udf3" value="" />
        <input type="hidden" name="udf4" value="" />
        <input type="hidden" name="udf5" value="" />

        <button type="button" onclick="generateAndSubmit()">Generate Hash & Submit to PayU</button>
      </form>

      <p style="font-size: 12px; color: #666; margin-top: 15px">
        <strong>Note:</strong> This form uses your actual PayU test keys and generates a proper
        SHA-512 hash. If everything works correctly, PayU should accept the payment.
      </p>
    </div>

    <div class="info">
      <h4>Expected Results:</h4>
      <ul>
        <li><strong>If form data is received:</strong> PayU will show "Invalid hash" error</li>
        <li>
          <strong>If form data is NOT received:</strong> PayU will show "Mandatory parameter
          missing" error
        </li>
      </ul>
      <p>This will help us determine if the issue is with form submission or hash generation.</p>
    </div>

    <script>
      // Your actual PayU test keys from the database
      const PAYU_CONFIG = {
        merchant_key: 'rjQUPktU',
        salt_key: 'e5iIg1jwi8UnzIZJJP9hK43y9PNYvBKBSFMvVHrOHx',
      };

      // Generate SHA-512 hash for PayU
      async function generatePayUHash(data) {
        // PayU hash format: key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5||||||SALT
        const hashString = [
          data.key,
          data.txnid,
          data.amount,
          data.productinfo,
          data.firstname,
          data.email,
          data.udf1 || '',
          data.udf2 || '',
          data.udf3 || '',
          data.udf4 || '',
          data.udf5 || '',
          '',
          '',
          '',
          '',
          '', // 5 empty fields
          PAYU_CONFIG.salt_key,
        ].join('|');

        console.log('Hash string:', hashString);

        const encoder = new TextEncoder();
        const data_encoded = encoder.encode(hashString);
        const hashBuffer = await crypto.subtle.digest('SHA-512', data_encoded);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join('');

        console.log('Generated hash:', hashHex);
        return hashHex;
      }

      async function generateAndSubmit() {
        const form = document.getElementById('payuTestForm');
        const txnid = 'PAYU_SIMPLE_TEST_' + Date.now();
        const productinfo = 'Simple Test Product (' + txnid + ')';

        // Prepare form data
        const formData = {
          key: PAYU_CONFIG.merchant_key,
          txnid: txnid,
          amount: '100.00',
          productinfo: productinfo,
          firstname: 'Test User',
          email: 'test@example.com',
          phone: '9999999999',
          surl: 'https://example.com/success',
          furl: 'https://example.com/failure',
          udf1: '',
          udf2: '',
          udf3: '',
          udf4: '',
          udf5: '',
        };

        // Generate hash
        const hash = await generatePayUHash(formData);

        // Populate form fields
        form.querySelector('[name="key"]').value = formData.key;
        form.querySelector('[name="txnid"]').value = formData.txnid;
        form.querySelector('[name="productinfo"]').value = formData.productinfo;
        form.querySelector('[name="hash"]').value = hash;

        // Log form data
        console.log('=== PayU Test Form Data ===');
        Object.entries(formData).forEach(([key, value]) => {
          console.log(`${key}: ${value}`);
        });
        console.log('hash:', hash);

        // Submit form
        console.log('Submitting to PayU...');
        form.submit();
      }

      // Initialize form when page loads
      window.onload = function () {
        console.log('PayU test page loaded with correct keys:', PAYU_CONFIG.merchant_key);
        console.log('Click "Generate Hash & Submit to PayU" to test payment');
      };
    </script>
  </body>
</html>
