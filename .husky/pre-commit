#!/usr/bin/env sh

# iwishBag Pre-commit Hook
# Prevents commits with schema issues or missing imports

echo "ğŸ” Running pre-commit validation..."

# Check TypeScript compilation for missing imports
echo "ğŸ“ Checking TypeScript compilation..."
npm run typecheck
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript compilation failed - check for missing imports"
  exit 1
fi

# Run ESLint to catch other issues
echo "ğŸ§¹ Running ESLint..."
npm run lint
if [ $? -ne 0 ]; then
  echo "âŒ ESLint found issues"
  exit 1
fi

# If local database is running, validate schema
if command -v supabase >/dev/null 2>&1; then
  if supabase status | grep -q "DB.*running"; then
    echo "ğŸ—„ï¸ Local database detected, running schema validation..."
    npm run validate-schema
    if [ $? -ne 0 ]; then
      echo "âŒ Schema validation failed"
      echo "ğŸ’¡ Run: npm run db:verify-schema"
      exit 1
    fi
  else
    echo "âš ï¸ Local database not running, skipping schema validation"
  fi
else
  echo "âš ï¸ Supabase CLI not found, skipping schema validation"
fi

echo "âœ… Pre-commit validation passed!"