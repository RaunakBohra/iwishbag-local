<!doctype html>
<html>
  <head>
    <title>Test PayU Form Submission</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
      }
      .test-section {
        border: 1px solid #ddd;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
      }
      .success {
        border-color: #4caf50;
        background: #f0f8f0;
      }
      .error {
        border-color: #f44336;
        background: #fdf0f0;
      }
      .warning {
        border-color: #ff9800;
        background: #fff8f0;
      }
      button {
        background: #2196f3;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #1976d2;
      }
      .log {
        background: #f5f5f5;
        padding: 10px;
        margin: 10px 0;
        border-radius: 3px;
        font-family: monospace;
      }
      pre {
        background: #f8f8f8;
        padding: 10px;
        border-radius: 3px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>PayU Form Submission Test</h1>

    <div class="test-section warning">
      <h3>⚠️ Important Note</h3>
      <p>
        This test will help diagnose why PayU is not receiving form data. The form will be submitted
        to PayU's test environment.
      </p>
    </div>

    <div class="test-section">
      <h3>Test 1: Manual Form Submission</h3>
      <p>This form contains the same data structure as your app would send:</p>

      <form id="testForm" method="POST" action="https://test.payu.in/_payment">
        <input type="hidden" name="key" value="TEST_KEY_12345" />
        <input type="hidden" name="txnid" value="PAYU_TEST_1752678321253" />
        <input type="hidden" name="amount" value="100.00" />
        <input type="hidden" name="productinfo" value="Test Product" />
        <input type="hidden" name="firstname" value="Test User" />
        <input type="hidden" name="email" value="test@example.com" />
        <input type="hidden" name="phone" value="9999999999" />
        <input type="hidden" name="surl" value="https://example.com/success" />
        <input type="hidden" name="furl" value="https://example.com/failure" />
        <input type="hidden" name="hash" value="test_hash_value_123" />
        <input type="hidden" name="udf1" value="" />
        <input type="hidden" name="udf2" value="" />
        <input type="hidden" name="udf3" value="" />
        <input type="hidden" name="udf4" value="" />
        <input type="hidden" name="udf5" value="" />

        <button type="submit">Submit to PayU (Test)</button>
      </form>

      <div id="formLog" class="log"></div>
    </div>

    <div class="test-section">
      <h3>Test 2: Dynamic Form Creation (Like Your App)</h3>
      <p>This simulates how your app creates and submits the form:</p>

      <button onclick="testDynamicForm()">Create & Submit Dynamic Form</button>
      <button onclick="testDynamicFormWithDelay()">Create & Submit with Delay</button>

      <div id="dynamicLog" class="log"></div>
    </div>

    <div class="test-section">
      <h3>Test 3: Form Data Validation</h3>
      <button onclick="validateFormData()">Validate Form Data</button>
      <div id="validationLog" class="log"></div>
    </div>

    <script>
      function log(containerId, message) {
        const container = document.getElementById(containerId);
        container.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
      }

      // Test dynamic form creation (like your app does)
      function testDynamicForm() {
        log('dynamicLog', 'Creating dynamic form...');

        const formData = {
          key: 'TEST_KEY_12345',
          txnid: 'PAYU_DYNAMIC_' + Date.now(),
          amount: '100.00',
          productinfo: 'Dynamic Test Product',
          firstname: 'Dynamic User',
          email: 'dynamic@example.com',
          phone: '9999999999',
          surl: 'https://example.com/success',
          furl: 'https://example.com/failure',
          hash: 'dynamic_hash_' + Date.now(),
          udf1: '',
          udf2: '',
          udf3: '',
          udf4: '',
          udf5: '',
        };

        // Create form exactly like your app
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = 'https://test.payu.in/_payment';
        form.style.display = 'none';

        // Add all fields
        Object.keys(formData).forEach((key) => {
          const input = document.createElement('input');
          input.type = 'hidden';
          input.name = key;
          input.value = formData[key] || '';
          form.appendChild(input);
          log('dynamicLog', `Added field: ${key} = ${formData[key]}`);
        });

        // Add to page
        document.body.appendChild(form);

        log('dynamicLog', 'Form created with ' + form.elements.length + ' fields');
        log('dynamicLog', 'Form action: ' + form.action);
        log('dynamicLog', 'Form method: ' + form.method);

        // Submit immediately
        try {
          log('dynamicLog', 'Submitting form...');
          form.submit();
        } catch (error) {
          log('dynamicLog', 'ERROR: ' + error.message);
        }
      }

      function testDynamicFormWithDelay() {
        log('dynamicLog', 'Creating dynamic form with delay...');

        const formData = {
          key: 'TEST_KEY_12345',
          txnid: 'PAYU_DELAY_' + Date.now(),
          amount: '100.00',
          productinfo: 'Delayed Test Product',
          firstname: 'Delayed User',
          email: 'delayed@example.com',
          phone: '9999999999',
          surl: 'https://example.com/success',
          furl: 'https://example.com/failure',
          hash: 'delayed_hash_' + Date.now(),
          udf1: '',
          udf2: '',
          udf3: '',
          udf4: '',
          udf5: '',
        };

        const form = document.createElement('form');
        form.method = 'POST';
        form.action = 'https://test.payu.in/_payment';
        form.style.display = 'none';

        Object.keys(formData).forEach((key) => {
          const input = document.createElement('input');
          input.type = 'hidden';
          input.name = key;
          input.value = formData[key] || '';
          form.appendChild(input);
        });

        document.body.appendChild(form);

        log('dynamicLog', 'Form created, waiting 200ms before submit...');

        setTimeout(() => {
          try {
            log('dynamicLog', 'Submitting after delay...');
            form.submit();
          } catch (error) {
            log('dynamicLog', 'ERROR: ' + error.message);
          }
        }, 200);
      }

      function validateFormData() {
        const form = document.getElementById('testForm');
        const formData = new FormData(form);

        log('validationLog', 'Validating form data...');

        const requiredFields = [
          'key',
          'txnid',
          'amount',
          'productinfo',
          'firstname',
          'email',
          'phone',
          'surl',
          'furl',
          'hash',
        ];
        const missingFields = [];

        requiredFields.forEach((field) => {
          const value = formData.get(field);
          if (!value) {
            missingFields.push(field);
          }
          log('validationLog', `${field}: ${value || '(empty)'}`);
        });

        if (missingFields.length > 0) {
          log('validationLog', 'MISSING FIELDS: ' + missingFields.join(', '));
        } else {
          log('validationLog', 'ALL REQUIRED FIELDS PRESENT');
        }

        log('validationLog', 'Total fields: ' + Array.from(formData.entries()).length);
      }

      // Log initial form data
      document.addEventListener('DOMContentLoaded', function () {
        log('formLog', 'Page loaded, manual form ready for testing');

        const testForm = document.getElementById('testForm');
        log('formLog', 'Manual form has ' + testForm.elements.length + ' fields');
        log('formLog', 'Form action: ' + testForm.action);
        log('formLog', 'Form method: ' + testForm.method);
      });
    </script>
  </body>
</html>
